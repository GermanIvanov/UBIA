<h1 id="прошивка-через-ota">Прошивка через OTA</h1>
<h2 id="подготовительный-этап">Подготовительный этап</h2>
<p>Прежде чем вы сможете воспользоваться механизмом обновления прошивки по воздуху (ОТА), вам необходимо обновить прошивку и загрузчик “традиционным” путем с помощью USB-COM программатора.</p>
<p>Открываете веб страницу расположенную <a href="https://github.com/pvvx/UBIA/tree/master/bin">тут</a>. Скачиваете оттуда себе на компьютер два файла: <strong>8266_jdy_10.bin</strong> и <strong>jdy_10_ota_72000.bin</strong> и сохраняете их в ту-же папку где у вас расположены файлы программатора.</p>
<p>Затем запускаете консоль и прошиваете в контроллер новую прошивку с помощью команды:</p>
<p><code>&gt; python.exe TlsrComProg.py -p COM14 -t 5000 we 0 8266_jdy_10.bin</code></p>
<p>Программа выведет на экран примерно такие текстовые сообщения. Убедитесь в том, что среди них не затесались какие-либо сообщения об ошибках.</p>
<pre><code>================================================
TLSR826x Floader version 01.03.20
------------------------------------------------
Open COM14, 230400 baud...
Reset module (RTS low)...
Activate (5000 ms)...
Connection...
Load &lt;floader.bin&gt; to 0x8000...
Bin bytes writen: 1880
CPU go Start...
------------------------------------------------
ChipID: 0x5325 (TLSR8266), Floader ver: 0.2
Flash JEDEC ID: 514013, Size: 512 kbytes
------------------------------------------------
Inputfile: 8266_jdy_10.bin
Write Flash data 0x00000000 to 0x0000ab04...
------------------------------------------------
Done!</code></pre>
<p>Следом за прошивкой заносим в контроллер ота-загрузчик. Для этого выполняем команду.</p>
<p><code>&gt; python.exe TlsrComProg.py -p COM14 -t 5000 we 0x72000 jdy_10_ota_72000.bin</code></p>
<p>Вывод команды схож с тем, который мы получали во время записи новой прошивки. Опять убеждаемся в отсутствии ошибок.</p>
<pre><code>================================================
TLSR826x Floader version 01.03.20
------------------------------------------------
Open COM14, 230400 baud...
Reset module (RTS low)...
Activate (5000 ms)...
Connection...
Load &lt;floader.bin&gt; to 0x8000...
Bin bytes writen: 1880
CPU go Start...
------------------------------------------------
ChipID: 0x5325 (TLSR8266), Floader ver: 0.2
Flash JEDEC ID: 514013, Size: 512 kbytes
------------------------------------------------
Inputfile: jdy_10_ota_72000.bin
Write Flash data 0x00072000 to 0x00072494...
------------------------------------------------
Done!</code></pre>
<p>На этом предварительная подготовка готова, переходим непосредственно к OTA обновлению.</p>
<h2 id="программируем-чип-через-ота">Программируем чип через ОТА</h2>
<p>Запускаем страницу расположенную по <a href="https://pvvx.github.io/ATC_MiThermometer/TelinkOTA.html">следующему адресу</a> с помощью браузера <strong>Chrome</strong>. Заострю ваше внимание, используйте браузер <strong>Chrome</strong> актуальной версии, не факт что ваш любимый альтернативный браузер сможет корректно выполнить код расположенный на данной странице.</p>
<p>Итак открываем страницу в <strong>Chrome</strong>, отыскиваем на ней строчку <em>“Select Firmware”</em> и нажимаем расположенную рядом с ней кнопку <em>“Обзор”</em>. С помощью стандартного интерфейса вашей операционной системы указываете на файл прошивки который вы хотите прошить. Ради тренировки рекомендую указать файл <strong>8266_jdy_10.bin</strong> который мы зашивали программатором в предыдущей главе. В логе снизу появятся строчки выглядящие примерно так:</p>
<pre><code>12:04:42: File was selected, size: 43780 bytes
12:04:42: Count: 2737</code></pre>
<p>Следующим шагом нажимаете кнопку <strong>Connect</strong>. Появится окошко выбора Bluetooth устройств. Выберите в нем то устройство которое вы хотите прошить.<br />
Как только вы это сделаете, в логе снизу сначала появится строчка</p>
<pre><code>12:07:49: Connecting to: tBLETST</code></pre>
<p>Где вместо <em>tBLETST</em> будет название вашего устройства.</p>
<p><strong>Ничего пока не делаем (!)</strong>, ждем появление следующей строчки, указывающей на то что устройство успешно подключилось. Ага вот и она!</p>
<pre><code>12:07:53: Connected.</code></pre>
<p>Нажимаем кнопку <em>“Start Flashing”</em>. В логе появляется строчка</p>
<pre><code>12:07:58: Start DFU</code></pre>
<p>А в поле <em>Status</em> побегут циферки индицирующие процесс загрузки. Когда она закончится и в логе и в поле статуса появится следующая строчка</p>
<pre><code>Update done after 44.149 seconds</code></pre>
<p>Вуаля! Мы с вами успешно завершили ОТА загрузку новой прошивки в ваш контроллер.</p>
